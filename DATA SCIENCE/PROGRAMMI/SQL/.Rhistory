library(DBI)
library(dplyr)
library(dbplyr)
library(nycflights13)
library(DBI)
library(dplyr)
library(dbplyr)
library(nycflights13)
nyc = dbConnect(RSQLite::SQLite(),"nycflights13")
nyc = dbConnect(RSQLite::SQLite(),"nycflights13")
install.packages(RSQLite)
install.packages("RSQLite")
nyc = dbConnect(RSQLite::SQLite(),"nycflights13")
flights = flights %>% arrange(year,month,day,sched_dep_time,carrier,flight) %>% mutate(id=row_number()) %>% select(id,everything())
head(flights)
id_set_planes = anti_join(flights,planes,by = "tailnum")$id
id_set_airports = anti_join(flights,airport,by =c("dest" = "faa"))$id
id_set_airports = anti_join(flights,airports,by =c("dest" = "faa"))$id
flights = mutate(flights,tailnum = ifelse(id %in% id_set_planes, NA, tailnum), dest = ifelse(id %in% id_set_airports),NA,dest)
flights = mutate(flights,tailnum = ifelse(id %in% id_set_planes, NA, tailnum), dest = ifelse(id %in% id_set_airports,NA,dest))
flights_db = tbl(nyc,"flights")
# write data frames into database tables (if necessary)
dbWriteTable(nyc, "flights", flights)
dbWriteTable(nyc, "airports", airports)
dbWriteTable(nyc, "planes", planes)
dbWriteTable(nyc, "weather", weather)
dbWriteTable(nyc, "airlines", airlines)
# list tables
dbListTables(nyc)
flights_db = tbl(nyc,"flights")
id_set_planes = anti_join(flights, planes, by = "tailnum")$id
id_set_airports = anti_join(flights, airports, by = c("dest" = "faa"))$id
flights =
mutate(flights, tailnum = ifelse(id %in% id_set_planes, NA, tailnum),
dest = ifelse(id %in% id_set_airports, NA, dest))
# write data frames into database tables (if necessary)
dbWriteTable(nyc, "flights", flights)
flights_db = tbl(nyc,"flights")
dbListFields(nyc, "flights")
flights_db <- tbl(nyc, "flights")
# dplyr
flights_db %>%
filter(month == 12 & day == 25)
## SQL
querySQL =
"select *
from flights
where month = 12 and day = 25"
dbGetQuery(nyc, querySQL)
## Load libraries
library(DBI)
library(dplyr)
library(dbplyr)
library(nycflights13)
# Connect to the database
nyc <- dbConnect(RSQLite::SQLite(), "nycflights13")
# Add surrogate key to flights
flights <-
flights %>%
arrange(year, month, day, sched_dep_time, carrier, flight) %>%
mutate(id = row_number()) %>%
select(id, everything())
# cure the violation of FKC
id_set_planes = anti_join(flights, planes, by = "tailnum")$id
id_set_airports = anti_join(flights, airports, by = c("dest" = "faa"))$id
flights =
mutate(flights, tailnum = ifelse(id %in% id_set_planes, NA, tailnum),
dest = ifelse(id %in% id_set_airports, NA, dest))
# write data frames into database tables (if necessary)
dbWriteTable(nyc, "flights", flights)
# flights on Christmas
flights_db <- tbl(nyc, "flights")
# dplyr
flights_db %>%
filter(month == 12 & day == 25)
## SQL
querySQL =
"select *
from flights
where month = 12 and day = 25"
sql_res = dbGetQuery(nyc, querySQL)
dplyr_res = dplyr_res %>% collect()
# dplyr
dplyr_res = flights_db %>%
filter(month == 12 & day == 25)
sql_res = dbGetQuery(nyc, querySQL)
dplyr_res = dplyr_res %>% collect()
setdiff(sql_res,dplyr_res)
setdiff(dplyr_res,sql_res)
# the number of flights per day
## dplyr
flights_db %>%
group_by(month, day) %>%
summarise(count = n())
## SQL
querySQL =
"select month, day, count(*) as count
from flights
group by month, day"
dbGetQuery(nyc, querySQL)
